# PID Controller

PID controller itself is rather straightforward and was implemented as a single class with method `Calculate` that also updates error sum and last cte used for differential term. Tuning it was more challenging. I decided to do it by hand - implementing Twiddle or other algorithm that would do it automatically wouldn't be that easy. Twiddle would require to run simulation over and over, to do it efficiently it should have some mean of returning car to home position and starting over. Also changing simulation from real time to some increased speed would help achieve results faster. With these problems in mind I made a decision to do it by hand as it would be faster.

Output from PID was directly used as a steering value (as in the classes) `double steer_value = -pid_steering.Calculate(cte);`. I think that there is another valuable option here - use it to change last steering `double steer_value = last_steer_value - pid_steering.Calculate(cte);`. Theoretically it should be more suitable here - during corners when error will be 0 some constant steering will be used and car should turn nicely. In simple case with direct PID output, when error comes to 0 so will angle and in corners car will oscillate. However it was really hard to make it work (with `last_steer_value`) and I was unable to find good parameters (it was difficult because PID would have to counter steering - change sign even before reaching target value). Another problem that I stumbled upon was discrepancies between reported angle values (`steering_angle` from simulation). Simple direct output isn't that smooth and some oscillations during turning happens, but generally it works.

Here I will shortly explain each parameter and how it was tuned:
* P - proportional - it sets output proportional to current error (CTE). It was the starting parameter for my tuning. I initially set it to 0.25, so that output would be maximal (-1 or 1) when car is close to edge of the road. Then I observed that it wasn't quite enough on the corners (car reacted too slow) so I increased it to 0.3. Proportional gain alone resulted in oscillations. 
* D - differential - second parameter that I tuned. It increases output proportional to difference between current and last CTE. When CTE is lowered it will reduce steering angle - with proportional term alone there were oscillations caused by car going at some angle to desired position, which caused overshooting. With differential term steering should be reduced when error is decreasing and in result car will approach desired value smoother. On the other hand it will cause to further increase in steering angle when error is increasing. In general differential term should add stability to system. I tuned it so that oscillations from proportional gain were cancelled. It turned out that this value had to be quite high (3.), which I think causes car to be quite sensible to noise (I think that it is visible once on the bridge).
* I - integral - final parameter. It helps with some constant bias happening in the system. For example wheels not being aligned correctly, which I think is the case here - when I manually set steering to 0, angle output in simulation was actually 0.44, which I think will contribute to bias. I set this value to be quite small (0.001). During simulation destination trajectory wasn't visible, so it was hard to tell what the difference really was, but I believe that in some cases it will help. I think that it could be further improved by changing sum of all errors to some kind of moving sum to take into account only N errors.

I also applied PID controller to change throttle value based on current speed (target speed is constant and set to 30MPH).